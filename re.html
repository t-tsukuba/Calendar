<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <title>実験装置予約カレンダー</title>
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css" rel="stylesheet">
    <style>
        body {
            font-family: sans-serif;
            padding: 20px;
        }

        #calendar {
            width: 100%;
            margin: 20px auto;
        }

        form {
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        label {
            display: block;
            margin: 5px 0;
        }

        input,
        select,
        textarea {
            width: 100%;
            margin-bottom: 10px;
        }

        /* 土曜の列：薄い青 */
        .fc-day-sat,
        .fc-col-header-cell.fc-day-sat {
            background-color: #e6f0ff !important;
        }

        /* 日曜の列：薄い赤 */
        .fc-day-sun,
        .fc-col-header-cell.fc-day-sun {
            background-color: #ffe6e6 !important;
        }
    </style>
</head>

<body>
    <h1>実験装置予約カレンダー</h1>
    <form id="reserveForm">
        <label>Equipment Type: <input type="text" id="equipment" required></label>
        <label>User Name: <input type="text" id="user" required></label>
        <label>month: <input type="number" id="month" min="1" max="12" required></label>
        <label>date: <input type="number" id="day" min="1" max="31" required></label>
        <label>start time: <input type="time" id="startTime" required></label>
        <label>end time: <input type="time" id="endTime" required></label>
        <label>Reservation Details: <textarea id="notes"></textarea></label>
        <button type="submit">予約登録</button>
    </form>
    <div id="calendar"></div>

    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
    <script>
        // 装置名ごとのカラー割り当て
        function getEquipmentColor(name) {
            switch (name.trim()) {
                case 'Instron': return 'red';
                case 'ラマン': return 'black';
                case 'DMA': return 'blue';
                case 'IR': return 'magenta';
                case '密度': return 'orange';
                case '蛍光': return 'green';
                default: return 'gray';
            }
        }

        // 予約データをlocalStorageから取得・保存
        function loadReservations() {
            return JSON.parse(localStorage.getItem('reservations') || '[]');
        }
        function saveReservations(data) {
            localStorage.setItem('reservations', JSON.stringify(data));
        }

        // 予約登録
        document.getElementById('reserveForm').onsubmit = function (e) {
            e.preventDefault();
            const equipment = document.getElementById('equipment').value;
            const user = document.getElementById('user').value;
            const month = document.getElementById('month').value.padStart(2, '0');
            const day = document.getElementById('day').value.padStart(2, '0');
            const startTime = document.getElementById('startTime').value;
            const endTime = document.getElementById('endTime').value;
            const notes = document.getElementById('notes').value;
            // 年は自動で現在年
            const year = new Date().getFullYear();
            const start = `${year}-${month}-${day}T${startTime}`;
            const end = `${year}-${month}-${day}T${endTime}`;
            const color = getEquipmentColor(equipment);
            // 一意ID作成（タイムスタンプ＋乱数）
            const id = Date.now().toString() + Math.floor(Math.random() * 1000).toString();
            let reservations = loadReservations();
            reservations.push({ id, equipment, user, start, end, notes, color });
            saveReservations(reservations);
            calendar.refetchEvents();
            this.reset();
        };

        // FullCalendarの初期化（ビュー切替ボタン追加）
        const calendar = new FullCalendar.Calendar(document.getElementById('calendar'), {
            initialView: 'dayGridMonth',
            locale: 'ja',
            headerToolbar: {
                left: 'prev,next today',
                center: 'title',
                right: 'dayGridMonth,timeGridWeek'
            },
            events: function (info, successCallback, failureCallback) {
                const reservations = loadReservations();
                let events = reservations.map(r => ({
                    id: r.id,
                    title: `${r.equipment} (${r.user})`,
                    start: r.start,
                    end: r.end,
                    color: r.color,
                    extendedProps: { notes: r.notes }
                }));
                successCallback(events);
            },
            eventClick: function (info) {
                // 予約枠クリックで削除確認
                let reservations = loadReservations();
                const idx = reservations.findIndex(x => String(x.id) === String(info.event.id));
                if (idx >= 0) {
                    if (confirm("この予約を削除しますか？")) {
                        reservations.splice(idx, 1);
                        saveReservations(reservations);
                        calendar.refetchEvents();
                    }
                } else {
                    alert('予約データが見つかりません。');
                }
            }
        });
        calendar.render();
    </script>
</body>

</html>
